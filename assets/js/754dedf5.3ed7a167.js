"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[52122],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>f});var o=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=c(n),f=i,h=d["".concat(s,".").concat(f)]||d[f]||p[f]||r;return n?o.createElement(h,a(a({ref:t},u),{},{components:n})):o.createElement(h,a({ref:t},u))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,a=new Array(r);a[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,a[1]=l;for(var c=2;c<r;c++)a[c]=n[c];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},62512:(e,t,n)=>{n.r(t),n.d(t,{frontMatter:()=>l,contentTitle:()=>s,metadata:()=>c,toc:()=>u,default:()=>d});var o=n(87462),i=n(63366),r=(n(67294),n(3905)),a=["components"],l={id:"channel-line-notify",title:"LINE Notify"},s=void 0,c={unversionedId:"channel-line-notify",id:"version-1.2.0/channel-line-notify",isDocsHomePage:!1,title:"LINE Notify",description:"What is LINE Notify",source:"@site/versioned_docs/version-1.2.0/channel-line-notify.md",sourceDirName:".",slug:"/channel-line-notify",permalink:"/docs/1.2.0/channel-line-notify",editUrl:"https://github.com/Yoctol/bottender/edit/master/docs/versioned_docs/version-1.2.0/channel-line-notify.md",tags:[],version:"1.2.0",lastUpdatedBy:"\u5433\u6771\u66c4 Wu, Dung-Ie",lastUpdatedAt:1636542901,formattedLastUpdatedAt:"11/10/2021",frontMatter:{id:"channel-line-notify",title:"LINE Notify"}},u=[{value:"What is LINE Notify",id:"what-is-line-notify",children:[],level:2},{value:"How to Use LINE Notify in Bottender",id:"how-to-use-line-notify-in-bottender",children:[{value:"Creating a LINE Notify Service",id:"creating-a-line-notify-service",children:[],level:3},{value:"Environment Variables Setting",id:"environment-variables-setting",children:[],level:3},{value:"Preparing the LINE Notify Instance",id:"preparing-the-line-notify-instance",children:[],level:3},{value:"Guiding Users to the LINE Notify Authorization Page",id:"guiding-users-to-the-line-notify-authorization-page",children:[],level:3},{value:"Receiving Authorization Code from Redirect and Send Notification by Access Token",id:"receiving-authorization-code-from-redirect-and-send-notification-by-access-token",children:[],level:3}],level:2},{value:"Limitations",id:"limitations",children:[],level:2}],p={toc:u};function d(e){var t=e.components,n=(0,i.Z)(e,a);return(0,r.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"what-is-line-notify"},"What is LINE Notify"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://notify-bot.line.me"},"LINE Notify")," is a LINE service that lets you send notifications to the subscribed users. Once a user subscribed to your service on LINE Notify, the user will become friends with LINE Notify automatically and you can send messages to the user through LINE Notify without extra cost."),(0,r.kt)("h2",{id:"how-to-use-line-notify-in-bottender"},"How to Use LINE Notify in Bottender"),(0,r.kt)("p",null,"If you want to have a clean project with LINE Notify, you could start from ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/Yoctol/bottender/tree/master/examples/line-notify"},"this example")," to develop your project. You can follow the following four steps to create your project:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Download the code from ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/Yoctol/bottender/tree/master/examples/line-notify"},(0,r.kt)("inlineCode",{parentName:"a"},"line-notify")," example"),"."),(0,r.kt)("li",{parentName:"ol"},"Run ",(0,r.kt)("inlineCode",{parentName:"li"},"yarn")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"npm install")," command to install all dependencies."),(0,r.kt)("li",{parentName:"ol"},"Fill the ",(0,r.kt)("inlineCode",{parentName:"li"},".env")," file with the correct values."),(0,r.kt)("li",{parentName:"ol"},"Run ",(0,r.kt)("inlineCode",{parentName:"li"},"yarn dev")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"npm run dev")," to start the dev server.")),(0,r.kt)("p",null,"If you want to have the folder structure we recommend, you could start with ",(0,r.kt)("a",{parentName:"p",href:"/docs/1.2.0/#create-a-new-bottender-app"},"create-bottender-app")," command and migrate it by following the migration instructions below."),(0,r.kt)("h3",{id:"creating-a-line-notify-service"},"Creating a LINE Notify Service"),(0,r.kt)("p",null,"To create a new LINE Notify service, open this ",(0,r.kt)("a",{parentName:"p",href:"https://notify-bot.line.me/my/services/new"},"link")," and submit the form after you finish it."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/3382565/74317707-da4baa80-4db6-11ea-93b0-68b5e6f2c8a9.png",alt:null})),(0,r.kt)("p",null,"The value of the callback URL should look like: ",(0,r.kt)("inlineCode",{parentName:"p"},"https://{your domain}.ngrok.io/notify/redirect")),(0,r.kt)("p",null,"Official API document\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://notify-bot.line.me/doc/en/"},"https://notify-bot.line.me/doc/en/")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Note:")," ",(0,r.kt)("a",{parentName:"p",href:"https://ngrok.com/"},"ngrok")," is a well-known service that provides public HTTPs URLs for your local server using the tunnel. It's handy when you develop your bot locally. You may want to use it when developing.")),(0,r.kt)("h3",{id:"environment-variables-setting"},"Environment Variables Setting"),(0,r.kt)("p",null,"If you are familiar with any official Bottender example, you may already know about how to use the ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file to manage your environment variables in your local project."),(0,r.kt)("p",null,"In this case, you need to add ",(0,r.kt)("inlineCode",{parentName:"p"},"LINE_NOTIFY_CLIENT_ID"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"LINE_NOTIFY_CLIENT_SECRET")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"ROOT_PATH")," to the ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file, so your file has those LINE related environment variables:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"LINE_ACCESS_TOKEN={your LINE access token from LINE Messaging API channel}\nLINE_CHANNEL_SECRET={your LINE channel secret from LINE Messaging API channel}\n\nLINE_NOTIFY_CLIENT_ID={your LINE Notify client id}\nLINE_NOTIFY_CLIENT_SECRET={your LINE Notify client secret}\nROOT_PATH={the ngrok public link}\n")),(0,r.kt)("h3",{id:"preparing-the-line-notify-instance"},"Preparing the LINE Notify Instance"),(0,r.kt)("p",null,"LINE Notify uses OAuth2 as the authorization mechanism. The minimum flow is as follows:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Guide users to the LINE Notify authorization page."),(0,r.kt)("li",{parentName:"ol"},"Receive the authorization code from LINE Notify redirect."),(0,r.kt)("li",{parentName:"ol"},"Exchange an access token with the authorization code."),(0,r.kt)("li",{parentName:"ol"},"Send a notification by the access token.")),(0,r.kt)("p",null,"Bottender provides a class ",(0,r.kt)("inlineCode",{parentName:"p"},"LineNotify")," to help you deal with LINE Notify APIs. You can create an instance of ",(0,r.kt)("inlineCode",{parentName:"p"},"LINENotify")," for later use."),(0,r.kt)("p",null,"Create a ",(0,r.kt)("inlineCode",{parentName:"p"},"lineNotify.js")," file in the root directory of the project and copy the following code into it:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const { LineNotify } = require('bottender');\n\nexport default new LineNotify({\n  clientId: process.env.LINE_NOTIFY_CLIENT_ID,\n  clientSecret: process.env.LINE_NOTIFY_CLIENT_SECRET,\n  redirectUri: `${process.env.ROOT_PATH}/notify/redirect`,\n});\n")),(0,r.kt)("h3",{id:"guiding-users-to-the-line-notify-authorization-page"},"Guiding Users to the LINE Notify Authorization Page"),(0,r.kt)("p",null,"To serve webpages, we need to add additional routes to the server. Fortunately, ",(0,r.kt)("a",{parentName:"p",href:"/docs/1.2.0/advanced-guides-custom-server#the-concept"},"custom server")," come to the rescue!"),(0,r.kt)("p",null,"You could use express, koa, restify, or whatever you like, but we are going to use express in this guide. Before going down, make sure that you set up correctly according to ",(0,r.kt)("a",{parentName:"p",href:"/docs/1.2.0/advanced-guides-custom-server#express"},"this guide"),"."),(0,r.kt)("p",null,"Modify ",(0,r.kt)("inlineCode",{parentName:"p"},"src/index.js")," to send the authorization link to your users:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const lineNotify = require('../lineNotify');\n\nmodule.exports = async function App(context) {\n  const url = lineNotify.getAuthLink('test');\n  await context.sendText(url);\n};\n")),(0,r.kt)("h3",{id:"receiving-authorization-code-from-redirect-and-send-notification-by-access-token"},"Receiving Authorization Code from Redirect and Send Notification by Access Token"),(0,r.kt)("p",null,"Add the following code snippet into ",(0,r.kt)("inlineCode",{parentName:"p"},"server.js")," to handle redirects from LINE Notify."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const lineNotify = require('../lineNotify');\n// ...\n\napp.prepare().then(() => {\n  //...\n\n  server.get('/notify/redirect', async function (req, res) {\n    const code = req.query.code;\n    const token = await lineNotify.getToken(code);\n    await lineNotify.sendNotify(token, 'Hello bottender!');\n    res.send('Subscribe successfully. Please close this page.');\n  });\n\n  // routes for webhook request\n  // ...\n});\n")),(0,r.kt)("p",null,"You can find all your subscriptions on the ",(0,r.kt)("a",{parentName:"p",href:"https://notify-bot.line.me/my/"},"Connected Services")," page."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Note:")," You should store access tokens for sending notifications in the future. We don't store them here, because it helps us simplify this demo.")),(0,r.kt)("h2",{id:"limitations"},"Limitations"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"The message format only allows text, image, and basic sticker, so you can't send, for example, a message with some buttons."),(0,r.kt)("li",{parentName:"ol"},"You can't have more than 1000 characters in a single text message."),(0,r.kt)("li",{parentName:"ol"},"The rate limit is 1000 messages per token per hour.")))}d.isMDXComponent=!0}}]);