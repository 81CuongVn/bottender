"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[26443],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(n),d=o,g=c["".concat(l,".").concat(d)]||c[d]||m[d]||i;return n?a.createElement(g,r(r({ref:t},u),{},{components:n})):a.createElement(g,r({ref:t},u))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},11569:(e,t,n)=>{n.r(t),n.d(t,{frontMatter:()=>s,contentTitle:()=>l,metadata:()=>p,assets:()=>u,toc:()=>m,default:()=>d});var a=n(87462),o=n(63366),i=(n(67294),n(3905)),r=["components"],s={title:"Bottender 1.4: Customizable Session Store, Messenger, LINE Features, Multi-language Documentation",author:"C. T. Lin",authorURL:"https://twitter.com/chentsulin",authorTitle:"Co-Creator of Bottender",authorTwitter:"chentsulin",authorImageURL:"https://avatars1.githubusercontent.com/u/3382565?s=460&v=4"},l=void 0,p={permalink:"/blog/2020/04/17/bottender-1_4",source:"@site/blog/2020-04-17-bottender-1_4.md",title:"Bottender 1.4: Customizable Session Store, Messenger, LINE Features, Multi-language Documentation",description:"Today we are very excited to introduce Bottender 1.4, featuring:",date:"2020-04-17T00:00:00.000Z",formattedDate:"April 17, 2020",tags:[],readingTime:4.815,truncated:!0,authors:[{name:"C. T. Lin",title:"Co-Creator of Bottender",url:"https://twitter.com/chentsulin",imageURL:"https://avatars1.githubusercontent.com/u/3382565?s=460&v=4"}],nextItem:{title:"Notice of LINE domain name change for certain endpoints",permalink:"/blog/2020/04/08/line-domain-name-change"}},u={authorsImageUrls:[void 0]},m=[{value:"Routes Readability Improvement",id:"routes-readability-improvement",children:[],level:2},{value:"Customizable Session Store",id:"customizable-session-store",children:[],level:2},{value:"Messenger One-Time Notification (Beta)",id:"messenger-one-time-notification-beta",children:[],level:2},{value:"Messenger Message Reaction Event",id:"messenger-message-reaction-event",children:[],level:2},{value:"Built-In LINE Notify Support",id:"built-in-line-notify-support",children:[],level:2},{value:"LINE Icon and Display Name Switch",id:"line-icon-and-display-name-switch",children:[],level:2},{value:"LINE Emoji in Text Messages",id:"line-emoji-in-text-messages",children:[],level:2},{value:"Multi-language Documentation Website",id:"multi-language-documentation-website",children:[],level:2}],c={toc:m};function d(e){var t=e.components,n=(0,o.Z)(e,r);return(0,i.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/3382565/79356403-7f2e6380-7f71-11ea-9180-c13b47642a42.png",alt:null})),(0,i.kt)("p",null,"Today we are very excited to introduce Bottender 1.4, featuring:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("a",{parentName:"strong",href:"/blog/2020/04/17/bottender-1_4#routes-readability-improvement"},"Routes Readability Improvement"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("a",{parentName:"strong",href:"/blog/2020/04/17/bottender-1_4#customizable-session-store"},"Customizable Session Store"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("a",{parentName:"strong",href:"/blog/2020/04/17/bottender-1_4#messenger-one-time-notification-beta"},"Messenger One-Time Notification (Beta)"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("a",{parentName:"strong",href:"/blog/2020/04/17/bottender-1_4#messenger-message-reaction-event"},"Messenger Message Reaction Event"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("a",{parentName:"strong",href:"/blog/2020/04/17/bottender-1_4#built-in-line-notify-support"},"Built-In LINE Notify Support"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("a",{parentName:"strong",href:"/blog/2020/04/17/bottender-1_4#line-icon-and-display-name-switch"},"LINE Icon and Display Name Switch"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("a",{parentName:"strong",href:"/blog/2020/04/17/bottender-1_4#line-emoji-in-text-messages"},"LINE Emoji in Text Messages"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("a",{parentName:"strong",href:"/blog/2020/04/17/bottender-1_4#multi-language-documentation-website"},"Multi-language Documentation Website")))),(0,i.kt)("p",null,"Besides, we also bring a bunch of TypeScript improvements into this release. If you're using TypeScript with Bottender in your project, you may want to upgrade and see the changes."),(0,i.kt)("h2",{id:"routes-readability-improvement"},"Routes Readability Improvement"),(0,i.kt)("p",null,"We add ",(0,i.kt)("inlineCode",{parentName:"p"},".any")," to the original route APIs to hint that they trigger the provided action when receiving ",(0,i.kt)("strong",{parentName:"p"},"any")," events on specific platform:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"messenger")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"messenger.any")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"line")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"line.any")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"telegram")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"telegram.any")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"whatsapp")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"whatsapp.any")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"slack")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"slack.any")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"viber")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"viber.any"))),(0,i.kt)("p",null,"Considering the following example, having ",(0,i.kt)("inlineCode",{parentName:"p"},".any")," can make the code easier to read:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"function App() {\n  return router([\n    messenger.postback(HandleMessengerPostback),\n    messenger.delivery(HandleMessengerDelivery),\n    messenger.read(HandleRead),\n    messenger.any(HandleMessengerEvent),\n    line.follow(HandleLINEFollow),\n    line.unfollow(HandleLINEUnfollow),\n    line.join(HandleLINEJoin),\n    line.leave(HandleLINELeave),\n    line.any(HandleLineEvent),\n  ]);\n}\n")),(0,i.kt)("h2",{id:"customizable-session-store"},"Customizable Session Store"),(0,i.kt)("p",null,"Starting from Bottender 1.4, Bottender supports using any custom session store that implemented the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Yoctol/bottender/blob/master/packages/bottender/src/session/SessionStore.ts"},"SessionStore")," interface."),(0,i.kt)("p",null,"To use your custom session store, set ",(0,i.kt)("inlineCode",{parentName:"p"},"driver")," to your custom key and put the instance of your session store to ",(0,i.kt)("inlineCode",{parentName:"p"},"stores")," accordingly in your ",(0,i.kt)("inlineCode",{parentName:"p"},"bottender.config.js")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"// bottender.config.js\n\nmodule.exports = {\n  session: {\n    driver: 'mysession',\n    stores: {\n      mysession: new MySessionStore();\n    },\n  },\n};\n")),(0,i.kt)("p",null,"So, now you can store your sessions in any storage, for example, Firebase and Amazon DynamoDB."),(0,i.kt)("h2",{id:"messenger-one-time-notification-beta"},"Messenger One-Time Notification (Beta)"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://developers.facebook.com/docs/messenger-platform/send-messages/one-time-notification"},"The Messenger Platform's One-Time Notification API (Beta)")," is a feature that allows a page to request a user permission for sending one follow-up message after the 24-hour messaging window has ended. The user will be offered to receive a future notification."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/3382565/79429450-18a15800-7ffa-11ea-82a8-61af539ac738.png",alt:null})),(0,i.kt)("p",null,"To send a one time notification template, call ",(0,i.kt)("inlineCode",{parentName:"p"},"context.sendOneTimeNotifReqTemplate()")," with a title and payload:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"async function MyAction(context) {\n  await context.sendOneTimeNotifReqTemplate({\n    title: '<TITLE_TEXT>',\n    payload: '<USER_DEFINED_PAYLOAD>',\n  });\n}\n")),(0,i.kt)("p",null,"When the user consents to be notified on a specific update, you will get an `optin' event with the payload and one-time token. You will need to store the token somewhere to use it in the future."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"function App() {\n  return router([\n    messenger.optin(async HandleOption(context) {\n      const { optin } = context.event;\n      if (optin.type === 'one_time_notif_req') {\n         // optin.payload -> the payload you sent in  `context.sendOneTimeNotifReqTemplate` request\n         // optin.oneTimeNotifToken -> the one-time token you need to store somewhere\n      }\n    }),\n  ]);\n}\n")),(0,i.kt)("p",null,"When the information becomes available, you can use this one-time token to send a follow up message to the user:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const { getClient } = require('bottender');\n\nconst messenger = getClient('messenger');\n\nmessenger.sendText(\n  { oneTimeNotifToken: 'ONE_TIME_TOKEN' },\n  'This is a one-time notification.'\n);\n")),(0,i.kt)("h2",{id:"messenger-message-reaction-event"},"Messenger Message Reaction Event"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://developers.facebook.com/docs/messenger-platform/reference/webhook-events/message-reactions/"},"Message reaction")," is a type of event that triggered when a user press and hold any message, and then tap to make the selection from the following types of emojis:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"smile"),(0,i.kt)("li",{parentName:"ul"},"angry"),(0,i.kt)("li",{parentName:"ul"},"sad"),(0,i.kt)("li",{parentName:"ul"},"wow"),(0,i.kt)("li",{parentName:"ul"},"love"),(0,i.kt)("li",{parentName:"ul"},"like"),(0,i.kt)("li",{parentName:"ul"},"dislike")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/3382565/79419985-85acf180-7fea-11ea-80d5-c99b4a665b70.jpg",alt:null})),(0,i.kt)("p",null,"To handle message reaction events, you must subscribe to the ",(0,i.kt)("inlineCode",{parentName:"p"},"message_reactions")," field for your page. And then you can do whatever you want when receiving ",(0,i.kt)("inlineCode",{parentName:"p"},"react")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"unreact")," events:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const { router, messenger } = require('bottender/router');\n\nfunction App() {\n  return router([\n    messenger.reaction.react(async function HandleReactionReact(context) {\n      // Handle react here\n      context.event.reaction.reaction; // \"love\"\n    }),\n    messenger.reaction.unreact(async function HandleReactionUnreact(context) {\n      // Handle unreact here\n    }),\n  ]);\n}\n")),(0,i.kt)("p",null,"It is particularly useful when you want to know the feedback from your users."),(0,i.kt)("h2",{id:"built-in-line-notify-support"},"Built-In LINE Notify Support"),(0,i.kt)("p",null,"Push API allows you to send messages directly to your users anytime. However, it might cost some money depends on the pricing plan in your country. ",(0,i.kt)("a",{parentName:"p",href:"https://notify-bot.line.me/"},"LINE Notify")," is a service that helps you build your notification app without the cost we mentioned earlier."),(0,i.kt)("p",null,"Bottender now supports LINE Notify using the ",(0,i.kt)("inlineCode",{parentName:"p"},"LineNotify")," class. You can use it to exchange the token and send notifications to the user:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const { LineNotify } = require('bottender');\n\nconst lineNotify = new LineNotify({\n  clientId: '<LINE_NOTIFY_CLIENT_ID>',\n  clientSecret: '<LINE_NOTIFY_CLIENT_SECRET>',\n  redirectUri: 'https://example.com/your/notify/redirect/path',\n});\n\nconst token = await lineNotify.getToken('<AUTHORIZATION_CODE>');\nawait lineNotify.sendNotify(token, 'Hello bottender!');\n")),(0,i.kt)("p",null,"To learn more about LINE Notify refer to the ",(0,i.kt)("a",{parentName:"p",href:"/docs/channel-line-notify"},"LINE Notify Documentation"),"."),(0,i.kt)("h2",{id:"line-icon-and-display-name-switch"},"LINE Icon and Display Name Switch"),(0,i.kt)("p",null,"Recently, LINE announced that ",(0,i.kt)("a",{parentName:"p",href:"https://developers.line.biz/zh-hant/news/2020/03/17/icon-nickname-switch/"},"icon and display name for LINE official account can be changed"),"."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/3382565/79414458-44faab80-7fdd-11ea-9b72-d039df1addf3.png",alt:null})),(0,i.kt)("p",null,"To change the icon and display name of your LINE Official Account, provide the ",(0,i.kt)("inlineCode",{parentName:"p"},"sender")," option:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"await context.sendText('Hello, I am Cony!!', {\n  sender: {\n    name: 'Cony',\n    iconUrl: 'https://line.me/conyprof',\n  },\n});\n")),(0,i.kt)("h2",{id:"line-emoji-in-text-messages"},"LINE Emoji in Text Messages"),(0,i.kt)("p",null,"You might have already learned that you can include LINE emojis in your text message:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"await context.sendText(\n  `Look at this: ${String.fromCodePoint(0x100084)} It's a LINE emoji!`\n);\n")),(0,i.kt)("p",null,"In ",(0,i.kt)("a",{parentName:"p",href:"https://developers.line.biz/zh-hant/news/2020/04/14/messaging-api-update-april-2020/"},"Messaging API Update for April 2020"),", LINE announced LINE original emoji in the previous example is deprecated."),(0,i.kt)("p",null,"Now you can provide the ",(0,i.kt)("inlineCode",{parentName:"p"},"emoji")," option includes an index, product ID, and emoji ID of the emojis in your text message:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"await context.sendText(\"Look at this: $ It's a LINE emoji!\", {\n  emojis: [\n    {\n      index: 14,\n      productId: '5ac1bfd5040ab15980c9b435',\n      emojiId: '001',\n    },\n  ],\n});\n")),(0,i.kt)("p",null,"For more emojis, see ",(0,i.kt)("a",{parentName:"p",href:"https://d.line-scdn.net/r/devcenter/sendable_line_emoji_list.pdf"},"Sendable LINE Emoji List"),"."),(0,i.kt)("h2",{id:"multi-language-documentation-website"},"Multi-language Documentation Website"),(0,i.kt)("p",null,"In this version, we start moving our official documentation website from English-only to multi-language. Thanks to ",(0,i.kt)("a",{parentName:"p",href:"https://docusaurus.io/"},"Docusaurus")," and ",(0,i.kt)("a",{parentName:"p",href:"https://crowdin.com/"},"Crowdin")," Open source Plan, the multi-language setup couldn't be easier."),(0,i.kt)("p",null,"The first language we try to translate is Traditional Chinese, and almost 70% of the latest documentation has been translated."),(0,i.kt)("p",null,"You can find the language switch dropdown on the website header:"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/3382565/79418575-927c1600-7fe7-11ea-9c41-4d69c9a5a4a9.png",alt:null})),(0,i.kt)("p",null,"We'll keep spending a lot of effort on improving our English documents because it's still a lot of important topics we need to cover."),(0,i.kt)("p",null,"If you're interested in helping translate those documents (especially other than Traditional Chinese), please contact us on Twitter ",(0,i.kt)("a",{parentName:"p",href:"https://twitter.com/bottenderjs"},"@bottenderjs")," or send email to ",(0,i.kt)("a",{parentName:"p",href:"mailto:bottender@yoctol.com"},"bottender@yoctol.com"),"."))}d.isMDXComponent=!0}}]);