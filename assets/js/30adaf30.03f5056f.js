"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[72668],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var o=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=o.createContext({}),c=function(e){var t=o.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=c(e.components);return o.createElement(i.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,i=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(n),d=r,v=p["".concat(i,".").concat(d)]||p[d]||m[d]||a;return n?o.createElement(v,s(s({ref:t},u),{},{components:n})):o.createElement(v,s({ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,s=new Array(a);s[0]=p;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:r,s[1]=l;for(var c=2;c<a;c++)s[c]=n[c];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}p.displayName="MDXCreateElement"},82706:(e,t,n)=>{n.r(t),n.d(t,{frontMatter:()=>l,contentTitle:()=>i,metadata:()=>c,toc:()=>u,default:()=>p});var o=n(87462),r=n(63366),a=(n(67294),n(3905)),s=["components"],l={id:"custom-connector",title:"CustomConnector",original_id:"custom-connector"},i=void 0,c={unversionedId:"custom-connector",id:"version-0.15.17/custom-connector",isDocsHomePage:!1,title:"CustomConnector",description:"To create a custom connector, you must implement the following classes:",source:"@site/versioned_docs/version-0.15.17/Guides-CustomConnector.md",sourceDirName:".",slug:"/custom-connector",permalink:"/docs/0.15.17/custom-connector",editUrl:"https://github.com/Yoctol/bottender/edit/master/docs/versioned_docs/version-0.15.17/Guides-CustomConnector.md",tags:[],version:"0.15.17",lastUpdatedBy:"\u5433\u6771\u66c4 Wu, Dung-Ie",lastUpdatedAt:1636542901,formattedLastUpdatedAt:"11/10/2021",frontMatter:{id:"custom-connector",title:"CustomConnector",original_id:"custom-connector"},sidebar:"version-0.15.17/docs",previous:{title:"Testing",permalink:"/docs/0.15.17/testing"},next:{title:"Troubleshooting",permalink:"/docs/0.15.17/troubleshooting"}},u=[{value:"CustomEvent",id:"customevent",children:[],level:2},{value:"CustomContext",id:"customcontext",children:[],level:2},{value:"CustomConnector",id:"customconnector",children:[{value:"getUniqueSessionKey",id:"getuniquesessionkey",children:[],level:3},{value:"updateSession",id:"updatesession",children:[],level:3},{value:"mapRequestToEvents",id:"maprequesttoevents",children:[],level:3},{value:"createContext",id:"createcontext",children:[],level:3}],level:2}],m={toc:u};function p(e){var t=e.components,n=(0,r.Z)(e,s);return(0,a.kt)("wrapper",(0,o.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"To create a custom connector, you must implement the following classes:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"CustomConnector")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"CustomContext")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"CustomEvent")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"CustomClient")," (optional)")),(0,a.kt)("h2",{id:"customevent"},"CustomEvent"),(0,a.kt)("p",null,"The event is a parser for the platform raw event. For example, if text messages have the following format on the custom platform:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"{\n  user: {\n    id: '123456',\n  },\n  message: {\n    text: 'Hello, world',\n  },\n}\n")),(0,a.kt)("p",null,"You can write a ",(0,a.kt)("inlineCode",{parentName:"p"},"CustomEvent")," class to hide the underlying complex raw event detail:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"class CustomEvent {\n  constructor(rawEvent) {\n    this._rawEvent = rawEvent;\n  }\n\n  get rawEvent() {\n    return this._rawEvent;\n  }\n\n  get isText() {\n    return !!(this._rawEvent.message && this._rawEvent.message.text);\n  }\n\n  get text() {\n    if (this.isText) {\n      return this._rawEvent.message.text;\n    }\n    return null;\n  }\n}\n")),(0,a.kt)("p",null,"Following getters are commonly cross-platform implemented:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"rawEvent")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"isMessage")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"message")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"isText")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"text")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"isPayload")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"payload"))),(0,a.kt)("p",null,"Feel free to implement platform only getter on it."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"class CustomEvent {\n  // ...\n  get isSuperCoolSomething() {}\n}\n")),(0,a.kt)("h2",{id:"customcontext"},"CustomContext"),(0,a.kt)("p",null,"The context is an abstraction of the current conversation context. Every context instance includes event, session, state, and all available context methods:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"{\n  event,\n  session,\n  state,\n  ...contextMethods,\n}\n")),(0,a.kt)("p",null,"You can write those context side effect methods directly or wrap another ",(0,a.kt)("inlineCode",{parentName:"p"},"CustomClient")," class to do the job."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"class CustomContext extends Context {\n  constructor({ event, session, initialState }) {\n    super({ event, session, initialState });\n  }\n\n  get platform() {\n    return 'custom';\n  }\n\n  async sendText(text) {\n    // ...\n  }\n\n  async typing(milliseconds) {\n    // ...\n  }\n}\n")),(0,a.kt)("p",null,"Following methods are commonly cross-platform implemented:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"sendText")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"typing"))),(0,a.kt)("h2",{id:"customconnector"},"CustomConnector"),(0,a.kt)("p",null,"The connector is a bridge between bot and platform. You need to implement the following methods to tell bot how to find session key from the request and create conversation context."),(0,a.kt)("h3",{id:"getuniquesessionkey"},"getUniqueSessionKey"),(0,a.kt)("p",null,"Find a unique session identifier, for example, user id, group id, channel id...and so on."),(0,a.kt)("h3",{id:"updatesession"},"updateSession"),(0,a.kt)("p",null,"If you need to prefetch something data or do some check for the session, you can put the logic here."),(0,a.kt)("h3",{id:"maprequesttoevents"},"mapRequestToEvents"),(0,a.kt)("p",null,"One request may have one or more than one raw events. For example, Messenger and LINE batch events into one request in some situation. Accordingly, you must return an array of event instances in this method."),(0,a.kt)("h3",{id:"createcontext"},"createContext"),(0,a.kt)("p",null,"Context factory."),(0,a.kt)("p",null,"Basic reference implementation:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"class CustomConnector {\n  get platform() {\n    return 'custom';\n  }\n\n  getUniqueSessionKey(body) {\n    return body.user.id;\n  }\n\n  updateSession(session) {\n    // do nothing\n  }\n\n  mapRequestToEvents(body) {\n    return [new CustomEvent(body)];\n  }\n\n  createContext({ event, session, initialState }) {\n    return new CustomContext({\n      event,\n      session,\n      initialState,\n    });\n  }\n}\n")),(0,a.kt)("p",null,"Finally, you can use ",(0,a.kt)("inlineCode",{parentName:"p"},"CustomConnector")," as a connector to create your bot:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const { Bot } = require('bottender');\n\nconst bot = new Bot({\n  connector: new CustomConnector({\n    /* */\n  }),\n});\n")),(0,a.kt)("p",null,"That's it!"))}p.isMDXComponent=!0}}]);