"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[40260],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>d});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},k=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),k=p(n),d=o,h=k["".concat(s,".").concat(d)]||k[d]||u[d]||r;return n?a.createElement(h,l(l({ref:t},c),{},{components:n})):a.createElement(h,l({ref:t},c))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,l=new Array(r);l[0]=k;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:o,l[1]=i;for(var p=2;p<r;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}k.displayName="MDXCreateElement"},2488:(e,t,n)=>{n.r(t),n.d(t,{frontMatter:()=>i,contentTitle:()=>s,metadata:()=>p,toc:()=>c,default:()=>k});var a=n(87462),o=n(63366),r=(n(67294),n(3905)),l=["components"],i={id:"channel-slack-setup",title:"Slack Setup"},s=void 0,p={unversionedId:"channel-slack-setup",id:"channel-slack-setup",isDocsHomePage:!1,title:"Slack Setup",description:"Requirements",source:"@site/../docs/channel-slack-setup.md",sourceDirName:".",slug:"/channel-slack-setup",permalink:"/docs/next/channel-slack-setup",editUrl:"https://github.com/Yoctol/bottender/edit/master/docs/../docs/channel-slack-setup.md",tags:[],version:"current",lastUpdatedBy:"\u5433\u6771\u66c4 Wu, Dung-Ie",lastUpdatedAt:1636542901,formattedLastUpdatedAt:"11/10/2021",frontMatter:{id:"channel-slack-setup",title:"Slack Setup"},sidebar:"docs",previous:{title:"Migrating from LINE SDK for Node.js",permalink:"/docs/next/channel-line-migrating-from-sdk"},next:{title:"Handling Slack Events",permalink:"/docs/next/channel-slack-handling-events"}},c=[{value:"Requirements",id:"requirements",children:[{value:"Create a Slack App",id:"create-a-slack-app",children:[],level:3},{value:"Install Slack App to Workspace",id:"install-slack-app-to-workspace",children:[],level:3}],level:2},{value:"Enabling Slack Channels",id:"enabling-slack-channels",children:[{value:"New Bottender Apps",id:"new-bottender-apps",children:[],level:3},{value:"Existing Bottender Apps",id:"existing-bottender-apps",children:[],level:3}],level:2},{value:"Environment Configuration",id:"environment-configuration",children:[{value:"Slack Access Token",id:"slack-access-token",children:[],level:3},{value:"Slack Signing Secret",id:"slack-signing-secret",children:[],level:3},{value:"Slack Verification Token (Deprecated)",id:"slack-verification-token-deprecated",children:[],level:3}],level:2},{value:"Webhook",id:"webhook",children:[],level:2}],u={toc:c};function k(e){var t=e.components,n=(0,o.Z)(e,l);return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/7aISWF9_jO4",frameborder:"0",allow:"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0}),(0,r.kt)("h2",{id:"requirements"},"Requirements"),(0,r.kt)("p",null,"Before going further, we assume that you already have:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"a Slack Account"),(0,r.kt)("li",{parentName:"ul"},"a ",(0,r.kt)("a",{parentName:"li",href:"https://slack.com/create#email"},"Slack Workspace"))),(0,r.kt)("h3",{id:"create-a-slack-app"},"Create a Slack App"),(0,r.kt)("p",null,"Create a ",(0,r.kt)("a",{parentName:"p",href:"https://api.slack.com/apps?new_app=1"},"Slack App")," if you haven't."),(0,r.kt)("p",null,(0,r.kt)("img",{width:"800",src:"https://user-images.githubusercontent.com/563929/82567644-3a20d100-9bb0-11ea-9c53-a04b62340db0.png"})),(0,r.kt)("p",null,"Click the ",(0,r.kt)("inlineCode",{parentName:"p"},"Create New App")," button."),(0,r.kt)("p",null,(0,r.kt)("img",{width:"800",src:"https://user-images.githubusercontent.com/563929/82567788-72c0aa80-9bb0-11ea-8233-48b604d3495e.png"})),(0,r.kt)("p",null,"Fill the ",(0,r.kt)("inlineCode",{parentName:"p"},"App Name")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Development Slack Workspace")," and then click the ",(0,r.kt)("inlineCode",{parentName:"p"},"Create App")," button."),(0,r.kt)("p",null,"We recommand creating a new workspace for experiment."),(0,r.kt)("h3",{id:"install-slack-app-to-workspace"},"Install Slack App to Workspace"),(0,r.kt)("p",null,"You can find the ",(0,r.kt)("inlineCode",{parentName:"p"},"Install App to Workspace")," button in ",(0,r.kt)("a",{parentName:"p",href:"https://api.slack.com/apps"},"Slack Developer Console")," \u2192 \\${YourApp} \u2192 OAuth & Permissions"),(0,r.kt)("p",null,(0,r.kt)("img",{width:"800",src:"https://user-images.githubusercontent.com/563929/82569943-80c3fa80-9bb3-11ea-997c-346a685d1adf.png"})),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Install App to Workspace")," button is disabled. To enable the button, you need to setup at least one of the permissions the Slack app need."),(0,r.kt)("p",null,"You can set those permissions in ",(0,r.kt)("a",{parentName:"p",href:"https://api.slack.com/apps"},"Slack Developer Console")," \u2192 \\${YourApp} \u2192 OAuth & Permissions \u2192 Scopes \u2192 Bot Token Scopes"),(0,r.kt)("p",null,(0,r.kt)("img",{width:"800",src:"https://user-images.githubusercontent.com/563929/82569279-9a187700-9bb2-11ea-9e9e-148c608202c4.png"})),(0,r.kt)("p",null,"Click the ",(0,r.kt)("inlineCode",{parentName:"p"},"Add an OAuth Scope")," button in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Bot Token Scopes")," section to create a ",(0,r.kt)("inlineCode",{parentName:"p"},"chat:write")," OAuth Scope, which allows Slack app to send messages as a bot user."),(0,r.kt)("p",null,(0,r.kt)("img",{width:"800",src:"https://user-images.githubusercontent.com/563929/82569788-4a867b00-9bb3-11ea-9ecd-d6c763d6860d.png"})),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Install App to Workspace")," button is enabled now."),(0,r.kt)("p",null,(0,r.kt)("img",{width:"800",src:"https://user-images.githubusercontent.com/563929/82570855-ba493580-9bb4-11ea-93aa-832df61de427.png"})),(0,r.kt)("p",null,"Click the ",(0,r.kt)("inlineCode",{parentName:"p"},"Install App to Workspace")," button."),(0,r.kt)("p",null,(0,r.kt)("img",{width:"800",src:"https://user-images.githubusercontent.com/563929/82571054-fda3a400-9bb4-11ea-9907-aa80d53519a5.png"})),(0,r.kt)("p",null,"This is the page for the Slack workspace authorizes to the Slack app."),(0,r.kt)("p",null,"Click the ",(0,r.kt)("inlineCode",{parentName:"p"},"Allow")," button."),(0,r.kt)("p",null,(0,r.kt)("img",{width:"800",src:"https://user-images.githubusercontent.com/563929/82573621-94be2b00-9bb8-11ea-991c-f7ae5cfffc15.png"})),(0,r.kt)("p",null,"Now, you installed the Slack app in your Slack workspace. This is also the place where you can get the access token Bottender need."),(0,r.kt)("h2",{id:"enabling-slack-channels"},"Enabling Slack Channels"),(0,r.kt)("p",null,"To enable Slack channels, you can start either from new or existing Bottender apps."),(0,r.kt)("h3",{id:"new-bottender-apps"},"New Bottender Apps"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Create Bottender App")," is the best way to start building a new app in Bottender."),(0,r.kt)("p",null,"To create a project, run:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"npx create-bottender-app my-app\n")),(0,r.kt)("p",null,"Make sure to select the ",(0,r.kt)("inlineCode",{parentName:"p"},"slack")," option:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/3382565/67851225-f2b7f200-fb44-11e9-8c86-eee0cbd7cb0d.png",alt:null})),(0,r.kt)("p",null,"After you go through the steps, ",(0,r.kt)("inlineCode",{parentName:"p"},"bottender.config.js")," and ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," are generated automatically for further channel settings."),(0,r.kt)("h3",{id:"existing-bottender-apps"},"Existing Bottender Apps"),(0,r.kt)("p",null,"First, you must have a ",(0,r.kt)("inlineCode",{parentName:"p"},"bottender.config.js")," file includes the following settings:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = {\n  channels: {\n    slack: {\n      enabled: true,\n      path: '/webhooks/slack',\n      accessToken: process.env.SLACK_ACCESS_TOKEN,\n      signingSecret: process.env.SLACK_SIGNING_SECRET,\n      // verificationToken: process.env.SLACK_VERIFICATION_TOKEN, // deprecated, use signingSecret\n    },\n  },\n};\n")),(0,r.kt)("p",null,"Make sure to set the ",(0,r.kt)("inlineCode",{parentName:"p"},"channels.slack.enabled")," field to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,r.kt)("p",null,"By default, the Bottender server listens to the Slack requests on the ",(0,r.kt)("inlineCode",{parentName:"p"},"/webhooks/slack")," path. However, you can overwrite the path by assigning the preferred webhook path in the ",(0,r.kt)("inlineCode",{parentName:"p"},"channels.slack.path")," field."),(0,r.kt)("p",null,"We highly recommend setting your sensitive config using ",(0,r.kt)("inlineCode",{parentName:"p"},"process.env"),", so you could avoid any credentials get exposed."),(0,r.kt)("h2",{id:"environment-configuration"},"Environment Configuration"),(0,r.kt)("p",null,"Bottender utilizes the ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/dotenv"},"dotenv")," package to load your environment variables when developing your app."),(0,r.kt)("p",null,"To make a Slack bot work, you must prepare the following environment variables, which you may put into your ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file later:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Slack Access Token"),(0,r.kt)("li",{parentName:"ul"},"Slack Signing Secret (or Slack Verification Token)")),(0,r.kt)("h3",{id:"slack-access-token"},"Slack Access Token"),(0,r.kt)("p",null,"You can find Slack access token in ",(0,r.kt)("a",{parentName:"p",href:"https://api.slack.com/apps"},"Slack Developer Console")," \u2192 \\${YourApp} \u2192 OAuth & Permissions \u2192 Bot User OAuth Access Token"),(0,r.kt)("p",null,(0,r.kt)("img",{width:"800",src:"https://user-images.githubusercontent.com/563929/82573621-94be2b00-9bb8-11ea-991c-f7ae5cfffc15.png"})),(0,r.kt)("p",null,"After you get your ",(0,r.kt)("strong",{parentName:"p"},"Slack Access Token"),", paste the value into the ",(0,r.kt)("inlineCode",{parentName:"p"},"SLACK_ACCESS_TOKEN")," field in your ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# .env\n\nSLACK_ACCESS_TOKEN=<YOUR SLACK ACCESS TOKEN>\n")),(0,r.kt)("h3",{id:"slack-signing-secret"},"Slack Signing Secret"),(0,r.kt)("p",null,"You can find Slack signing secret in ",(0,r.kt)("a",{parentName:"p",href:"https://api.slack.com/apps"},"Slack Developer Console")," \u2192 \\${YourApp} \u2192 Basic Information \u2192 App Credentials \u2192 Signing Secret."),(0,r.kt)("p",null,(0,r.kt)("img",{width:"800",src:"https://user-images.githubusercontent.com/563929/82585491-a7406080-9bc8-11ea-9fbc-e91b72cc6eb9.png"})),(0,r.kt)("p",null,"After you get your ",(0,r.kt)("strong",{parentName:"p"},"Slack Signing Secret"),", paste the value into the ",(0,r.kt)("inlineCode",{parentName:"p"},"SLACK_SIGNING_SECRET")," field in your ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# .env\n\nSLACK_SIGNING_SECRET=<YOUR SLACK SIGNING SECRET>\n")),(0,r.kt)("h3",{id:"slack-verification-token-deprecated"},"Slack Verification Token (Deprecated)"),(0,r.kt)("p",null,"We recommend using signing secret instead of verification token, but we also support verification token."),(0,r.kt)("p",null,"You can find Slack verification token in ",(0,r.kt)("a",{parentName:"p",href:"https://api.slack.com/apps"},"Slack Developer Console")," \u2192 \\${YourApp} \u2192 Basic Information \u2192 App Credentials \u2192 Verification Token."),(0,r.kt)("p",null,(0,r.kt)("img",{width:"800",src:"https://user-images.githubusercontent.com/563929/82585491-a7406080-9bc8-11ea-9fbc-e91b72cc6eb9.png"})),(0,r.kt)("p",null,"After you get your ",(0,r.kt)("strong",{parentName:"p"},"Slack Verification Token"),", paste the value into the ",(0,r.kt)("inlineCode",{parentName:"p"},"SLACK_VERIFICATION_TOKEN")," field in your ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# .env\n\n# SLACK_VERIFICATION_TOKEN=<YOUR SLACK VERIFICATION TOKEN> # deprecated, use `SLACK_SIGNING_SECRET` instead\n")),(0,r.kt)("h2",{id:"webhook"},"Webhook"),(0,r.kt)("p",null,"After finishing the above settings, you can start your server with Slack webhook event listening using the following commands:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# in production mode\nnpm start\n\n# or in development mode\nnpm run dev\n")),(0,r.kt)("p",null,"When you run bottender in development mode, Bottender automatically run up a ngrok client, and then you can get the information of webhook URL from the console like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"App has started\nslack webhook URL: https://42bbf602.ngrok.io/webhooks/slack\nserver is running on 5000 port...\n")),(0,r.kt)("p",null,"Then, you have to copy your Slack webhook URL to ",(0,r.kt)("a",{parentName:"p",href:"https://api.slack.com/apps"},"Slack Developer Console")," \u2192 \\${YourApp} \u2192 Event Subscriptions, where you can pick which bot events to subscribe."),(0,r.kt)("p",null,(0,r.kt)("img",{width:"800",src:"https://user-images.githubusercontent.com/563929/82586277-e58a4f80-9bc9-11ea-9d72-748685aed912.png"})),(0,r.kt)("p",null,"Turn on the switch."),(0,r.kt)("p",null,(0,r.kt)("img",{width:"800",src:"https://user-images.githubusercontent.com/563929/82586465-2a15eb00-9bca-11ea-86ad-2a198e8f3ca1.png"})),(0,r.kt)("p",null,"Fill the Request URL field with your Slack webhook URL."),(0,r.kt)("p",null,(0,r.kt)("img",{width:"800",src:"https://user-images.githubusercontent.com/563929/82586596-65b0b500-9bca-11ea-83eb-db2a032e5205.png"})),(0,r.kt)("p",null,"You can see the word ",(0,r.kt)("inlineCode",{parentName:"p"},"Verified")," after setting the webhook URL."),(0,r.kt)("p",null,"Now, open the ",(0,r.kt)("inlineCode",{parentName:"p"},"Subscribe to bot events")," block to subscribe some events."),(0,r.kt)("p",null,(0,r.kt)("img",{width:"800",src:"https://user-images.githubusercontent.com/563929/82587023-1454f580-9bcb-11ea-89ef-896f9c5fbac9.png"})),(0,r.kt)("p",null,"Add the following events to receive the corresponding webhook requests:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"message.im: A message was posted in a direct message channel."),(0,r.kt)("li",{parentName:"ul"},"message.groups: A message was posted to a private channel."),(0,r.kt)("li",{parentName:"ul"},"message.channels: A message was posted to a public channel."),(0,r.kt)("li",{parentName:"ul"},"message.mpim: A message was posted in a multiparty direct message channel.")),(0,r.kt)("p",null,"For more information about Slack Events, please refer to Slack's official doc, ",(0,r.kt)("a",{parentName:"p",href:"https://api.slack.com/events"},"API Event Types")),(0,r.kt)("p",null,(0,r.kt)("img",{width:"800",src:"https://user-images.githubusercontent.com/563929/82587693-38650680-9bcc-11ea-8767-3ef0c7540ca9.png"})),(0,r.kt)("p",null,"Click the ",(0,r.kt)("inlineCode",{parentName:"p"},"Save Changes")," button."),(0,r.kt)("p",null,(0,r.kt)("img",{width:"800",src:"https://user-images.githubusercontent.com/563929/82587787-5df21000-9bcc-11ea-8718-d27bd3809053.png"})),(0,r.kt)("p",null,"Reinstall your app."),(0,r.kt)("p",null,(0,r.kt)("img",{width:"800",src:"https://user-images.githubusercontent.com/563929/82587889-88dc6400-9bcc-11ea-86e2-ecf091f68f7a.png"})),(0,r.kt)("p",null,"Now, you can see the slack app require more permissions."),(0,r.kt)("p",null,"Click the ",(0,r.kt)("inlineCode",{parentName:"p"},"Allow")," button. Now you can chat with the slack bot in direct message channel or in any channel the slack bot in."),(0,r.kt)("p",null,"The next thing you can do is ",(0,r.kt)("a",{parentName:"p",href:"https://bottender.js.org/docs/en/getting-started#teaching-your-bot-to-echo"},"teaching your bot to echo"),"."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Note:")," If your bot doesn't respond after webhook settings, please take a closer look at bot events you subscribed to. Slack doesn't pick any bot events subscription by default. The first bot event you may subscribe to is ",(0,r.kt)("inlineCode",{parentName:"p"},"message.im"),", which is the event whenever a user posts a direct message to your bot.")))}k.isMDXComponent=!0}}]);