"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[54646],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>h});var a=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=a.createContext({}),u=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},c=function(e){var n=u(e.components);return a.createElement(s.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},p=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(t),h=o,g=p["".concat(s,".").concat(h)]||p[h]||d[h]||i;return t?a.createElement(g,r(r({ref:n},c),{},{components:t})):a.createElement(g,r({ref:n},c))}));function h(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,r=new Array(i);r[0]=p;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var u=2;u<i;u++)r[u]=t[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},18103:(e,n,t)=>{t.r(n),t.d(n,{frontMatter:()=>l,contentTitle:()=>s,metadata:()=>u,toc:()=>c,default:()=>p});var a=t(87462),o=t(63366),i=(t(67294),t(3905)),r=["components"],l={id:"advanced-guides-nlu",title:"Natural Language Understanding",original_id:"advanced-guides-nlu"},s=void 0,u={unversionedId:"advanced-guides-nlu",id:"version-1.0.5/advanced-guides-nlu",isDocsHomePage:!1,title:"Natural Language Understanding",description:"Leverage NLU Technologies",source:"@site/versioned_docs/version-1.0.5/advanced-guides-nlu.md",sourceDirName:".",slug:"/advanced-guides-nlu",permalink:"/docs/1.0.5/advanced-guides-nlu",editUrl:"https://github.com/Yoctol/bottender/edit/master/docs/versioned_docs/version-1.0.5/advanced-guides-nlu.md",tags:[],version:"1.0.5",lastUpdatedBy:"\u5433\u6771\u66c4 Wu, Dung-Ie",lastUpdatedAt:1636542901,formattedLastUpdatedAt:"11/10/2021",frontMatter:{id:"advanced-guides-nlu",title:"Natural Language Understanding",original_id:"advanced-guides-nlu"},sidebar:"version-1.0.5/docs",previous:{title:"Error Handling",permalink:"/docs/1.0.5/the-basics-errors"},next:{title:"Multi-Messaging Channel Support",permalink:"/docs/1.0.5/advanced-guides-multi-channel"}},c=[{value:"Leverage NLU Technologies",id:"leverage-nlu-technologies",children:[],level:2},{value:"Building with Dialogflow",id:"building-with-dialogflow",children:[],level:2},{value:"Building with QnA Maker",id:"building-with-qna-maker",children:[],level:2},{value:"Building with LUIS",id:"building-with-luis",children:[],level:2},{value:"Building with Rasa NLU",id:"building-with-rasa-nlu",children:[],level:2}],d={toc:c};function p(e){var n=e.components,t=(0,o.Z)(e,r);return(0,i.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"leverage-nlu-technologies"},"Leverage NLU Technologies"),(0,i.kt)("p",null,"If you want to have more general intent recognition, you can leverage modern NLU (Natural Language Understanding) technologies. They can help you recognize the intent of user input sentences. There are several online services you can choose from, for example:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/1.0.5/advanced-guides-nlu#building-with-dialogflow"},"Dialogflow")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/1.0.5/advanced-guides-nlu#building-with-qna-maker"},"QnA Maker")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/1.0.5/advanced-guides-nlu#building-with-luis"},"LUIS")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/1.0.5/advanced-guides-nlu#building-with-rasa-nlu"},"Rasa"))),(0,i.kt)("h2",{id:"building-with-dialogflow"},"Building with Dialogflow"),(0,i.kt)("p",null,"To build a bot integrated with ",(0,i.kt)("a",{parentName:"p",href:"https://dialogflow.com/"},"Dialogflow"),", you have to set up Dialogflow following the ",(0,i.kt)("a",{parentName:"p",href:"https://cloud.google.com/dialogflow/docs/quick/setup"},"Official Setup Guide")," and fill the two values: ",(0,i.kt)("inlineCode",{parentName:"p"},"GOOGLE_APPLICATION_CREDENTIALS")," (the file path of the JSON file that contains your service account key) and ",(0,i.kt)("inlineCode",{parentName:"p"},"GOOGLE_APPLICATION_PROJECT_ID")," (the GCP project ID) into the ",(0,i.kt)("inlineCode",{parentName:"p"},".env")," file."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# .env\nGOOGLE_APPLICATION_CREDENTIALS=\nGOOGLE_APPLICATION_PROJECT_ID=\n")),(0,i.kt)("p",null,"Next, you can build an agent following the ",(0,i.kt)("a",{parentName:"p",href:"https://cloud.google.com/dialogflow/docs/quick/build-agent"},"official document"),". In this example, we build an agent and create a simple intent with display name ",(0,i.kt)("inlineCode",{parentName:"p"},"greeting"),". You can set your own training phrases on the Dialogflow console for this intent."),(0,i.kt)("p",null,"After you finish the settings of the agent, you can then call Dialogflow's API to detect the intention of the message the bot receives. We use ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/googleapis/nodejs-dialogflow"},"Dialogflow Node SDK")," to integrate our bot with Dialogflow."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const dialogflow = require('dialogflow');\n\nconst PROJECT_ID = process.env.GOOGLE_APPLICATION_PROJECT_ID;\n\nconst sessionClient = new dialogflow.SessionsClient();\n\nmodule.exports = async function App(context) {\n  if (context.event.isText) {\n    const sessionPath = sessionClient.sessionPath(\n      PROJECT_ID,\n      context.session.id\n    );\n\n    const request = {\n      session: sessionPath,\n      queryInput: {\n        text: {\n          text: context.event.text,\n          languageCode: 'en',\n        },\n      },\n      queryParams: {\n        timeZone: '',\n      },\n    };\n\n    const responses = await sessionClient.detectIntent(request);\n    const { intent } = responses[0].queryResult;\n\n    if (intent.displayName === 'greeting') {\n      await context.sendText('Hello!');\n    }\n  }\n};\n")),(0,i.kt)("p",null,"You can check out the full example ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Yoctol/bottender/tree/master/examples/with-dialogflow"},"Here"),"."),(0,i.kt)("p",null,"For more information about how to use Dialogflow with Node.js, you can check ",(0,i.kt)("a",{parentName:"p",href:"https://googleapis.dev/nodejs/dialogflow/latest/index.html"},"Dialogflow: Node.js Client Document"),"."),(0,i.kt)("h2",{id:"building-with-qna-maker"},"Building with QnA Maker"),(0,i.kt)("p",null,"To build a bot integrated with ",(0,i.kt)("a",{parentName:"p",href:"https://www.qnamaker.ai/"},"QnA Maker"),", you have to create the QnA Maker knowledge base and publish it following the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/cognitive-services/qnamaker/quickstarts/create-publish-knowledge-base"},"Official Guide"),"."),(0,i.kt)("p",null,"After you publish your knowledge base, you will get ",(0,i.kt)("inlineCode",{parentName:"p"},"RESOURCE_NAME"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"KNOWLEDGE_BASE_ID"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"ENDPOINT_KEY")," (See ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/cognitive-services/qnamaker/quickstarts/get-answer-from-knowledge-base-using-url-tool?pivots=url-test-tool-postman"},"Here")," for detailed guide). Make sure you copy them into the ",(0,i.kt)("inlineCode",{parentName:"p"},".env")," file."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# .env\nRESOURCE_NAME=\nKNOWLEDGE_BASE_ID=\nENDPOINT_KEY=\n")),(0,i.kt)("p",null,"Next, we can get the answer by calling the API endpoint. In the example, we use ",(0,i.kt)("inlineCode",{parentName:"p"},"axios")," as our HTTP client. For other Node HTTP clients like ",(0,i.kt)("inlineCode",{parentName:"p"},"request-promise"),", you can see this ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/cognitive-services/qnamaker/quickstarts/get-answer-from-knowledge-base-nodejs"},"document"),". The returned response will contain an array with possible QA pairs and corresponding scores. You can define your own score threshold in the code."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const axios = require('axios');\n\nconst { RESOURCE_NAME, KNOWLEDGE_BASE_ID, ENDPOINT_KEY } = process.env;\n\nmodule.exports = async function App(context) {\n  if (context.event.isText) {\n    const { data } = await axios.post(\n      `https://${RESOURCE_NAME}.azurewebsites.net/qnamaker/knowledgebases/${KNOWLEDGE_BASE_ID}/generateAnswer`,\n      { question: context.event.text },\n      {\n        headers: {\n          Authorization: `EndpointKey ${ENDPOINT_KEY}`,\n        },\n      }\n    );\n\n    const topAnswer = data.answers[0];\n\n    // You can define your own score threshold here.\n    if (topAnswer.score > 70) {\n      await context.sendText(topAnswer.answer);\n    }\n  }\n};\n")),(0,i.kt)("p",null,"You can check out the full example ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Yoctol/bottender/tree/master/examples/with-qna-maker"},"Here"),"."),(0,i.kt)("h2",{id:"building-with-luis"},"Building with LUIS"),(0,i.kt)("p",null,"To build a bot integrated with ",(0,i.kt)("a",{parentName:"p",href:"https://luis.ai/"},"LUIS (Language Understanding Intelligent Service)"),", you have to create a new app in the LUIS portal following the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/azure/cognitive-services/LUIS/get-started-portal-build-app"},"Official Setup Guide")," and fill the three values: ",(0,i.kt)("inlineCode",{parentName:"p"},"LUIS_APP_ID"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"LUIS_APP_KEY"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"LUIS_APP_ENDPOINT")," into the ",(0,i.kt)("inlineCode",{parentName:"p"},".env")," file."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# .env\n\nLUIS_APP_ID=\nLUIS_APP_KEY=\nLUIS_APP_ENDPOINT=\n")),(0,i.kt)("p",null,"Next, you can add a simple intent. In this example, we create a simple intent with the intent name ",(0,i.kt)("inlineCode",{parentName:"p"},"greeting"),". You can set your own training phrases on the LUIS console for this intent. And then you have to train the model and publish it."),(0,i.kt)("p",null,"After publishing successfully, you can call LUIS's API to detect the intention of the message the bot receives. In this example, we use ",(0,i.kt)("inlineCode",{parentName:"p"},"axios")," as our HTTP client to call the API."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const axios = require('axios');\n\nconst { LUIS_APP_KEY, LUIS_APP_ENDPOINT, LUIS_APP_ID } = process.env;\n\nmodule.exports = async function App(context) {\n  if (context.event.isText) {\n    const queryParams = {\n      verbose: true,\n      q: context.event.text,\n      'subscription-key': LUIS_APP_KEY,\n    };\n\n    const { data } = await axios.get(\n      `${LUIS_APP_ENDPOINT}luis/v2.0/apps/${LUIS_APP_ID}`,\n      {\n        params: queryParams,\n      }\n    );\n\n    const { topScoringIntent } = data;\n\n    if (topScoringIntent.intent === 'greeting') {\n      await context.sendText('Hello!');\n    }\n  }\n};\n")),(0,i.kt)("p",null,"You can check out the full example ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Yoctol/bottender/tree/master/examples/with-luis.ai"},"Here"),"."),(0,i.kt)("h2",{id:"building-with-rasa-nlu"},"Building with Rasa NLU"),(0,i.kt)("p",null,"To build a bot integrated with ",(0,i.kt)("a",{parentName:"p",href:"https://rasa.com/docs/rasa/nlu/about/"},"Rasa NLU"),", you have to install Rasa first following the ",(0,i.kt)("a",{parentName:"p",href:"https://rasa.com/docs/rasa/user-guide/installation/"},"Official Installation Guide"),". Next, you can train your NLU model by running:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"rasa train nlu\n")),(0,i.kt)("p",null,"This command will look for the training data files in the data/ directory and saves the model in the models/ directory. For information about how to generate training data, you can see ",(0,i.kt)("a",{parentName:"p",href:"https://rasa.com/docs/rasa/nlu/training-data-format/"},"here"),"."),(0,i.kt)("p",null,"After you get your NLU model ready, you can run the following command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"rasa run --enable-api -m models/nlu-your-model-id.tar.gz\n")),(0,i.kt)("p",null,"This will start a server with your NLU model locally on port 5005. Next, you can request predictions from your model by calling the ",(0,i.kt)("inlineCode",{parentName:"p"},"/model/parse")," endpoint. You can see ",(0,i.kt)("a",{parentName:"p",href:"https://rasa.com/docs/rasa/api/http-api/#operation/parseModelMessage"},"here")," for the document of this API."),(0,i.kt)("p",null,"In this example, we use ",(0,i.kt)("inlineCode",{parentName:"p"},"axios")," as our HTTP client. The returned response will contain an intent with its corresponding confidence. You can define your own confidence threshold in the code."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const axios = require('axios');\n\nmodule.exports = async function App(context) {\n  if (context.event.isText) {\n    const { data } = await axios.post(`http://localhost:5005/model/parse`, {\n      text: context.event.text,\n    });\n\n    const { intent } = data;\n\n    // You can define your own confidence threshold here.\n    if (intent.confidence > 0.7) {\n      if (intent.name === 'greeting') {\n        await context.sendText('Hello!');\n      }\n    }\n  }\n};\n")),(0,i.kt)("p",null,"You can check out the full example ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Yoctol/bottender/tree/master/examples/with-rasa"},"Here"),"."))}p.isMDXComponent=!0}}]);